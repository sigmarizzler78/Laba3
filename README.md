# Лабораторная работа №5. Хранение данных. Настройки и внешние файлы.
Студент: Перов Иван, ИСП-221С

Это Android-приложение позволяет скачивать PDF-файлы журналов с сайта ИТМО, используя их ID. Пользовательский интерфейс интуитивно понятен и предоставляет возможности загрузки, просмотра и удаления скачанных файлов. При первом запуске отображается краткая инструкция.

## Работа приложения




![Screenshot_2024-12-04-18-52-27-295_com example l5](https://github.com/user-attachments/assets/611439ca-adaf-414e-a454-61344eacb5f4)


## Функциональность приложения:

Приложение выполняет следующие действия:

• Загрузка файлов: Асинхронно скачивает PDF-файлы с использованием библиотеки OkHttp, предотвращая блокировку пользовательского интерфейса. Проверяет успешность запроса и тип содержимого, отображая соответствующие сообщения об ошибках или успешной загрузке.

• Просмотр файлов: Открывает скачанный PDF-файл с помощью установленного на устройстве приложения для чтения PDF-файлов, используя FileProvider для безопасного доступа к файлу. Обрабатывает ситуацию отсутствия подходящего приложения для просмотра PDF-файлов.

• Удаление файлов: Позволяет удалить скачанный файл с устройства.

• Управление настройками: Использует SharedPreferences для хранения информации о том, нужно ли отображать инструкцию при запуске.

• Обработка разрешений: Запрашивает разрешение на запись во внешнее хранилище (WRITE_EXTERNAL_STORAGE) и обрабатывает результат запроса.

• Отображение статуса: В реальном времени информирует пользователя о статусе загрузки через элемент TextView.


## Пользовательский интерфейс (UI):

Главное окно приложения состоит из следующих элементов:

• journalIdEditText: Поле для ввода ID журнала (целое число).

• downloadButton: Кнопка для запуска загрузки PDF-файла.

• viewButton: Кнопка для просмотра загруженного файла (активируется после загрузки).

• deleteButton: Кнопка для удаления загруженного файла (активируется после загрузки).

• statusTextView: Отображает текущий статус загрузки и сообщения об ошибках.


## Подробное описание ключевых методов:

### downloadFile()

Этот метод отвечает за загрузку PDF-файла и состоит из следующих шагов:

1. Получение ID журнала: Извлекает ID журнала из поля journalIdEditText. Обрабатывает случай пустого поля ввода.
2. Формирование URL: Создает URL для загрузки PDF-файла, используя полученный ID (https://ntv.ifmo.ru/file/journal/{journalId}.pdf).
3. Отправка запроса: Использует OkHttp для отправки GET-запроса к серверу. Загрузка выполняется в отдельном потоке.
4. Обработка ответа: Проверяет код ответа и тип содержимого (Content-Type). Обрабатывает ошибки и отображает соответствующие сообщения пользователю.
5. Сохранение файла: Если загрузка успешна, сохраняет файл в директорию загрузок (Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS)).
6. Обновление UI: Обновляет statusTextView и активирует кнопки "Смотреть" и "Удалить" в главном потоке с помощью runOnUiThread.

### openPDF()

Открывает скачанный PDF-файл с помощью системного приложения для просмотра PDF-файлов, используя FileProvider. Обрабатывает исключение ActivityNotFoundException в случае отсутствия подходящего приложения.

### deleteFile()

Удаляет файл с устройства и обновляет пользовательский интерфейс.

## Обработка разрешений:

Приложение запрашивает разрешение на запись во внешнее хранилище (WRITE_EXTERNAL_STORAGE).
```
private void requestStoragePermission() {
    if (ContextCompat.checkSelfPermission(this, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {
        ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, REQUEST_STORAGE_PERMISSION);
    } else {
        downloadFile();
    }
}

@Override
public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
    super.onRequestPermissionsResult(requestCode, permissions, grantResults);
    if (requestCode == REQUEST_STORAGE_PERMISSION) {
        if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
            downloadFile();
        } else {
            Toast.makeText(this, "Permission denied", Toast.LENGTH_SHORT).show();
        }
    }
}

```
## Сборка проекта:

1. Клонирование репозитория: Клонируйте репозиторий с помощью git clone [URL репозитория].
2. Открытие проекта: Откройте проект в Android Studio.
3. Запуск приложения: Нажмите кнопку "Run" в Android Studio.
